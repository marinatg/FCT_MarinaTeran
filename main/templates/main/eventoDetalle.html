{% extends 'base.html' %}
{% load i18n %}

<html>
{% block content %}
<head>
 <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      <script>
      document.addEventListener("DOMContentLoaded", function() {
      console.log("dentro de la funcion");
        var asientos = document.getElementById("asientosDisponibles");
        console.log(asientos);
        var arrayAsientos = asientos.getElementsByTagName("input");
        console.log(arrayAsientos);
        var unidades = document.getElementById("unidades");
        var uds = unidades.value;

        for(var i = 0; i < arrayAsientos.length; i++){
           arrayAsientos[i].addEventListener('change', function(){
                if (this.checked) {
                    console.log("dentro del if");
                    uds = parseInt(uds) + 1;
                    unidades.value = parseInt(uds);
                }else {
                    uds = uds - 1;
                    unidades.value = uds;
                }
            });
        }
      });
  </script>
</head>
<body>
<div class="container">

  <div class="row align-items-start">
    <div class="row">
        <div class="col rounded float-start  m-5"><h1 style="font-family: Arial Black; font-weight: bold; font-size: 60px; color: #b392ac; text-shadow: -1px 0 #000, 0 1px #000, 1px 0 #000, 0 -1px #000;">Concierto de {{ evento.nombre }}</h1></div>
      <div class="col rounded float-end"><img class="col rounded float-end m-5" src="{{ evento.imagen.url }}" height="230"/></div>
    </div>
  </div>

    <div class="row">

        <div class="col">
        <h3>Escoge una zona: </h3>
        <form method="get">
            {% for z in zonas %}
                {{ zonita }}
                {{ forloop.counter }}
                {% if zonita == forloop.counter %}
                    <input type="radio" id="zona{{ forloop.counter }}" name="zona" value="{{ forloop.counter }}" checked>
                {% else %}
                    <input type="radio" id="zona{{ forloop.counter }}" name="zona" value="{{ forloop.counter }}" >
                {% endif %}
                <label for="zona{{ forloop.counter }}">{{z.zona.nombre}} ({{z.precio}}â‚¬)</label><br>
            {% endfor %}
            <p></p>
            <button class="btn btn-info mb-3" type="submit">Ver asientos</button>
        </form>




        <div style="border: 1px solid purple;">
        <form  enctype="multipart/form-data" method="get">

            {% csrf_token %}
            {{ form.as_p }}

            <table id="asientosDisponibles">
                <tr>
        {% for a in asientos %}
                    <td>
                    {% if a.estado == False %}
                    <input type="checkbox" id="{{a.id}}" name="{{a.id}}" value="{{a.id}}">
                    {% else %}
                     <input type="checkbox" id="{{a.id}}" name="{{a.id}}" value="{{a.id}}" disabled>
                    {% endif %}
                    <label for="{{a.id}}">{{ a.asiento.nombre }}</label>
                    </td>
                {% if forloop.counter|divisibleby:4 %}
                </tr>
                <tr>
                {% endif %}

        {% endfor %}
                </tr>
             </table>
                </div>
            </div>

            <div class="col">
            <div class="card">
            <div class="card-body" style="background-color: #b392ac;">

                <h5 class="card-subtitle">Fecha:</h5>
                <p>{{ evento.fecha_hora }}</p>
                <hr/>
                <p class="card-text">Sala: {{ evento.sala.nombre }}.</p>
                <hr/>
              {% if evento.disponibles == 0 %}
                <p class="alert alert-danger">Entradas no disponibles</p>
              {% else %}
                <p>Entradas disponibles: {{ zonaElegida.disponibles }} uds.</p>

                    <label>Uds: </label>
                    <input type="number" id="unidades" name="unidades" value=0 readonly>
              <button href="{% url 'paypal' %}" class="btn btn-success" name="boton" type="submit">Comprar</button>
        </form>
              {% endif %}
            </div>
        </div>
    </div>
</div>


</div>
</body>
{% endblock %}
</html>